<div *ngIf="isLoading" class="loading-spinner">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<div *ngIf="!isLoading && user" class="user-details">
  <!-- User Profile Card -->
  <div class="profile-card">
    <h2>{{ user.username }}'s Profile</h2>
    <div class="online-status">
      <span class="badge" [ngClass]="user.is_online ? 'badge-success' : 'badge-secondary'">
        {{ user.is_online ? 'Online' : 'Offline' }}
      </span>
    </div>
    <img
      *ngIf="user.profile?.avatar || user.avatar"
      [src]="user.profile?.avatar || user.avatar"
      alt="Avatar"
      class="avatar"
    />
    <h3>{{ user.profile?.display_name || user.display_name || user.username }}</h3>
    <p><strong>Email:</strong> {{ user.email }}</p>

    <!-- Level, XP, and Progress -->
    <div class="level-info">
      <h4>Level {{ user.level }}</h4>
      <p>XP: {{ user.xp }} / {{ user.xp_for_next_level }}</p>
      <div class="progress">
        <div
          class="progress-bar"
          role="progressbar"
          [style.width.%]="getXpProgress()"
          [attr.aria-valuenow]="getXpProgress()"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          {{ getXpProgress() | number: '1.0-0' }}%
        </div>
      </div>
    </div>
  </div>

  <!-- Game History Section -->
  <div class="game-history">
    <h3>{{ user.username }}'s Games</h3>
    <div *ngIf="games.length > 0; else noGamesTemplate">
      <div *ngFor="let game of games" class="game-item">
        <a [routerLink]="['/games/details/', game.id]" class="game-link">
          <strong>{{ game.player1.username }}</strong>
          <span class="vs">VS</span>
          <strong>{{ game.player2.username || 'AI' }}</strong>
        </a>
        <p class="game-mode">Mode: {{ game.game_mode }} | Score: {{ game.score_player1 }} : {{ game.score_player2 }}</p>
        <span class="badge" [ngClass]="{'badge-success': game.is_completed}">Completed</span>
      </div>
    </div>
  </div>

  <!-- Error Template -->
  <ng-template #errorTemplate>
    <p class="alert alert-danger text-center"> {{ errorMessage }}</p>
  </ng-template>

  <!-- No Games Template -->
  <ng-template #noGamesTemplate>
    <p class="alert alert-info text-center mb-0">This user has no games.</p>
  </ng-template>
</div>
