<div *ngIf="isLoading">Loading...</div>
<div *ngIf="!isLoading && userProfile">
  <h2>Your Profile</h2>

  <div>
    <strong>ID:</strong> {{ userProfile.id }}
  </div>
  <div>
    <strong>Username:</strong> {{ userProfile.username }}
  </div>
  <div>
    <strong>Email:</strong> {{ userProfile.email }}
  </div>

  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
    <div>
      <label for="display_name"><strong>Display Name:</strong></label>
      <input id="display_name" formControlName="display_name" type="text" />
    </div>

    <div>
      <label for="avatar"><strong>Avatar:</strong></label><br />
      <img
        [src]="avatarPreview"
        alt="Avatar"
        width="150"
        height="150"
        onerror="this.onerror=null; this.src='assets/default_avatar.png';"
      /><br />
      <input id="avatar" type="file" (change)="onFileChange($event)" />
    </div>

    <button type="submit">Update Profile</button>
  </form>

  <!-- Game History Section -->
  <h3>Your Game History</h3>
  <div *ngIf="gameHistory.length > 0; else noHistory">
    <ul>
      <li *ngFor="let game of gameHistory">
        <p><strong>Game ID:</strong> {{ game.id }}</p>
        <p><strong>Mode:</strong> {{ game.game_mode }}</p>
        <p><strong>Score:</strong> {{ game.player1.username }} ({{ game.score_player1 }}) vs 
          {{ game.player2 ? game.player2.username : 'AI' }} ({{ game.score_player2 }})
        </p>
        <p><strong>Winner:</strong> {{ game.winner?.username || 'AI' }}</p>
        <p><strong>Duration:</strong> {{ game.duration | number: '1.2-2' }} seconds</p>
      </li>
    </ul>
  </div>
  <ng-template #noHistory>
    <p>No game history available.</p>
  </ng-template>
</div>

<div *ngIf="!isLoading && !userProfile">
  <p>No profile data available.</p>
</div>
