<div class="notifications-icon" (click)="toggleNotifications()">
  <i class="fas fa-bell">ICON</i>
  <span *ngIf="unreadCount > 0" class="badge badge-danger">{{ unreadCount }}</span>
</div>

<div class="notifications-container card" *ngIf="showNotifications">
  <div class="card-header d-flex justify-content-between">
    <h5 class="mb-0">Notifications</h5>
    <button class="btn btn-sm btn-secondary" (click)="markAllAsRead()">Mark All as Read</button>
  </div>

  <ul class="list-group list-group-flush">
    <li
      *ngFor="let notification of notifications"
      [ngClass]="getPriorityClass(notification.priority)"
      class="list-group-item notification-item"
      (click)="handleNotification(notification)"
    >
      <i
        [ngClass]="{
          'fa fa-user-plus': notification.notification_type === 'friend_request',
          'fa fa-gamepad': notification.notification_type === 'game_invite',
          'fa fa-envelope': notification.notification_type === 'new_message'
        }"
        class="notification-icon"
      ></i>
      <div class="notification-content">
        <span *ngIf="notification.sender?.username; else noUsername">
          {{ notification.sender.username }} {{ getNotificationText(notification.notification_type) }}
        </span>
        <ng-template #noUsername>
          <span>
            {{ notification.sender }} {{ getNotificationText(notification.notification_type) }}
          </span>
        </ng-template>
        <small class="text-muted">{{ notification.timestamp | date: 'short' }}</small>
      </div>
      <button
        *ngIf="!notification.is_read"
        class="btn btn-sm btn-outline-warning mark-read-btn"
        (click)="markAsRead(notification); $event.stopPropagation();"
      >
        Mark as Read
      </button>
    </li>
  </ul>
</div>


<!-- Friend Request Dialog -->
<app-friend-request-dialog
  *ngIf="showFriendRequestDialog && currentNotification"
  [notification]="currentNotification"
  (close)="onCloseFriendRequestDialog($event)"
></app-friend-request-dialog>

<!-- Game Invite Dialog -->
<app-game-invite-dialog
  *ngIf="showGameInviteDialog && currentNotification"
  [notification]="currentNotification"
  (close)="onCloseGameInviteDialog($event)"
></app-game-invite-dialog>

<!-- Chat Window -->
<app-chat-window
  *ngIf="selectedFriendId && selectedFriendUsername"
  [friendId]="selectedFriendId"
  [friendUsername]="selectedFriendUsername"
  (close)="closeChat()"
></app-chat-window>
